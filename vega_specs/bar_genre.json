{
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "title":{"text":"Anime per genre","color":"#e5e7eb"},
  "background":"#0b0f14",
  "width": 720,
  "height": 420,
  "params": [
    {
      "name": "TypeSel",
      "value": "TV",
      "bind": {"input": "select", "options": ["TV","Movie","OVA","ONA","Special","Music"], "name": "Type (Select): "}
    }
  ],
  "data":{
    "url":"https://raw.githubusercontent.com/ssha0312/FIT3179-A2/refs/heads/main/data/anime_cleaned.csv",
    "format":{"type":"csv"}
  },
  "transform":[
    {"filter":"isValid(datum.type) && trim(datum.type) != '' && datum.type == TypeSel"},
    {"calculate":"split(datum.genre || '', ',')","as":"genre_list"},
    {"flatten":["genre_list"]},
    {"calculate":"trim(datum.genre_list)","as":"genre_item"},
    {"filter":"datum.genre_item != '' && lower(datum.genre_item) != 'hentai'"},
    {"aggregate":[{"op":"count","as":"n"}],"groupby":["genre_item"]}
  ],
  "mark":{"type":"bar","cornerRadiusEnd":3},
  "encoding":{
    "y":{
      "field":"genre_item","type":"nominal",
      "sort":{"field":"n","order":"descending"},
      "axis":{"title":null,"labelColor":"#cbd5e1"}
    },
    "x":{
      "field":"n","type":"quantitative",
      "axis":{"title":"No. of Anime","labelColor":"#cbd5e1","grid":true, "format":","}
    },
    "color":{"value":"#60a5fa"},
    "tooltip":[
      {"field":"genre_item","title":"Genre"},
      {"field":"n","title":"Anime","format":","}
    ]
  },
  "config":{"view":{"stroke":null}}
}
